meta {
    title: "Enhanced Power";
    description: "style for rendering power infrastructure";
    version: "0.1_2025-12-01";
    author: "Kits";
    icon: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNyAxOCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTM4NSAtNTI0LjM2KSI+PHBhdGggZmlsbD0iIzIwMmQyMCIgZD0ibSAzODUgNTI0LjM2IGggMTcgdiAxOCBoIC0xNyB6Ii8+PGcgZmlsbD0ibm9uZSI+PGcgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIgc3Ryb2tlLXdpZHRoPSIxLjgiPjxwYXRoIGQ9Im0gMzg3LjUgNTI1LjI2IHYgMTYuMiIgc3Ryb2tlPSIjZTRlN2U0Ii8+PHBhdGggZD0ibSAzOTkuNSA1MjUuMjYgdiAxNi4yIiBzdHJva2U9IiNlNWU3ZTUiLz48L2c+PHBhdGggZD0ibSAzOTMuNSA1MjYuMzYgdiA0IiBzdHJva2U9IiNlNWU3ZTUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIxLjciLz48L2c+PHBhdGggZD0ibSAzOTMuNSA1MzUuMzYgdiA0IiBmaWxsPSIjZTRlN2U0IiBzdHJva2U9IiNlNWU3ZTUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIxLjciLz48L2c+PC9zdmc+";
    link: ""; 
}

canvas {
    default-points: false;
}

/* default nodes */
/*============================================================================================*/

way[power=cable] > node|z15-,
way[power=line][line=busbar] > node|z15-,
way[power=line][line=bay] > node|z15-{
	symbol-shape: square;
	symbol-size: 5;
	symbol-fill-color: white;
	symbol-stroke-color:black;
}

way[power=cable] > node|z15-:tagged,
way[power=line][line=busbar] > node|z15-:tagged,
way[power=line][line=bay] > node|z15-:tagged{
	symbol-fill-color: #00b0ff;
}

/* untagged node on a power line */
way[power=line][line!=busbar][line!=bay] > node|z13-,
way[power=minor_line][line!=busbar][line!=bay] > node|z16-,
way[communication=line] > node|z15-,
way[telecom=line] > node|z15-{
	symbol-shape: square;
	symbol-fill-color: red;
	symbol-stroke-color:yellow;
	symbol-size: 6;
}

/* Poles & Towers Far */
/*============================================================================================*/
node|z15-[man_made=utility_pole],
node|z15-[power=pole],
node|z13-[power=tower]
{
    set .pole;
    symbol-shape: square;
	symbol-size: 5;
	symbol-fill-color: white;
	symbol-fill-opacity: 1;
	symbol-stroke-color: black;
	symbol-stroke-width: 1;
    symbol-stroke-opacity: 1;
}

node[power=tower].pole{
	symbol-size: 10;
}

/* Pole Color */
node[utility~=telecom].pole 	{ symbol-fill-color: #21bd00;}
node[utility~=television].pole  { symbol-fill-color: #21bd00;}
node[utility~=gas].pole		    { symbol-fill-color: #ff0000;}
node[utility~=oil].pole		    { symbol-fill-color: #708090;}
node[utility~=water].pole		{ symbol-fill-color: #2090cf;}
node[utility~=sewerage].pole	{ symbol-fill-color: #1d5575;}
node[utility~=waste].pole		{ symbol-fill-color: #ee82ee;}
node[utility~=power].pole,
node[power=pole],
node[power=tower]               { symbol-fill-color: #FFFF00;} 


/* Poles & Towers Close */
/*============================================================================================*/
node|z16-.pole{
    set .pole_close
}

node.pole_close{
    icon-image:"presets/tower/pole.svg";
}

node.pole_close[man_made=utility_pole][utility~=power],
node.pole_close[power=pole]{
    icon-image:"presets/power/pole.svg";
} 

node.pole_close[power=tower]{
    icon-image:"presets/power/tower.svg";
}


/* Line_management*/
node[is_prop_set("pole_close", "default")][line_management=transition]::pole_type{
	symbol-shape: triangle;
	symbol-size: 28;
    symbol-opacity: 1;
	symbol-stroke-color: yellow;
}

node[is_prop_set("pole_close", "default")][line_management=branch]::pole_type{
	symbol-shape: hexagon;
	symbol-size: 25;
	symbol-stroke-color: yellow;
}

node[is_prop_set("pole_close", "default")][line_management=termination]::pole_type{
	symbol-shape: square;
	symbol-size: 20;
	symbol-stroke-color: yellow;
}

node[is_prop_set("pole_close", "default")][line_management=split]::pole_type{
	symbol-shape: circle;
	symbol-size: 20;
	symbol-stroke-color: yellow;
}

/* Utility Pole Halo */
node[is_prop_set("pole_close", "default")][man_made=utility_pole][utility][utility!=power]::utility_casing{
	symbol-fill-color: prop("symbol-fill-color","default");
    symbol-shape: circle;
    symbol-size: 16;
}


/* Substations */
/*============================================================================================*/



/* Components */
/*============================================================================================*/

/* Standalone transformer */
node|z18-[power=transformer]::primary{
	icon-image:"presets/power/transformer.svg";
	text-color: red;
    font-size: 8;
    text: tag("voltage:primary");
    text-halo-radius: 2;
    text-offset-x: 1;
    text-offset-y: 10;
}

node|z18-[power=transformer]::secondary{
	icon-image:"presets/power/transformer.svg";
	text-color: red;
    font-size: 8;
    text: tag("voltage:secondary");
    text-halo-radius: 2;
    text-offset-x: 1;
    text-offset-y: 0;
}

/* portal */
node|z16-[power=portal]{
	icon-image:"presets/power/portal.svg";
}

/* compensator */
node|z16-[power=compensator]{
	icon-image:"presets/power/compensator.svg";
}

/* switch */
node|z16-[power=switch]{
	icon-image:"presets/power/switch.svg";
}

node|z16-[power=switch][switch=circuit_breaker]::bg
{
	symbol-shape: square;
	symbol-size: 21;
	symbol-fill-color: red;
	symbol-opacity:1;
	z-index:-1;
}

node|z16-[power=switch][switch=disconnector]::bg
{
	symbol-shape: square;
	symbol-size: 21;
	symbol-fill-color: blue;
	symbol-opacity:1;
	z-index:-1;
}

/* terminal */
node|z16-[power=terminal]{
	icon-image:"presets/power/terminal.svg";
}

/* connection */
node|z16-[power=connection]{
	icon-image:"presets/power/connection.svg";
}

/* Power Lines */
/*============================================================================================*/

way[power=~/line|minor_line|cable/]{
	voltage_color_400000: #B54EB2;
	voltage_color_275000: #FF0000;
	voltage_color_132000: #B55D00;
	voltage_color_66000: #B59F10;
	voltage_color_33000: #55B555;
	voltage_color_11000: #3030ff;
	voltage_color_400: #FF00FF;
	voltage_color_0: #444444;
	voltage_list: split(";",tag("voltage"));
	voltage_count: length(prop("voltage_list"));
    circuits_count: cond(tag("circuits")>10,10,cond(has_tag_key("circuits"),tag("circuits")-1,0) );
	seperation: -5;

	half_width: prop(circuits_count) * prop("seperation") / 2 ;
}

way[power=~/line|minor_line|cable/]
{
	opacity:0;
	offset:0;
    width:1;
}

/* Cables */
way[power=cable]
{  
	casing-width: prop(circuits_count) * 5/2;
    casing-opacity:0.5;
	casing-color:#F4BB44;
}

way[power=cable]::line_0{dashes: 15,5;}
way[power=cable]::line_1{dashes: 15,5;}
way[power=cable]::line_2{dashes: 15,5;}
way[power=cable]::line_3{dashes: 15,5;}
way[power=cable]::line_4{dashes: 15,5;}
way[power=cable]::line_5{dashes: 15,5;}
way[power=cable]::line_6{dashes: 15,5;}
way[power=cable]::line_7{dashes: 15,5;}
way[power=cable]::line_8{dashes: 15,5;}
way[power=cable]::line_9{dashes: 15,5;}
way[power=cable]::line_10{dashes: 15,5;}


way|z16-[power=~/line|minor_line|cable/][circuits > 1]
{
	/* circuits label */
    text: tag("circuits");
    font-size:14px;
	text-halo-radius:2;
}

way[power=~/line|minor_line|cable/]::line_0
{   
	line_num: 0;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}


way[power=~/line|minor_line|cable/][circuits>1]::line_1
{   
	line_num: 1;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>2]::line_2
{   
	line_num: 2;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>3]::line_3
{   
	line_num: 3;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>4]::line_4
{   
	line_num: 4;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>5]::line_5
{   
	line_num: 5;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>6]::line_6
{   
	line_num: 6;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>7]::line_7
{   
	line_num: 7;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>8]::line_8
{   
	line_num: 8;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}

way[power=~/line|minor_line|cable/][circuits>9]::line_9
{   
	line_num: 9;
	width: 2;
	offset: prop("line_num") * prop("seperation","default") - prop("half_width","default");
	voltage_index: cond(prop("voltage_count","default") == 1, 0, prop("line_num"));
	this_voltage: get(prop("voltage_list","default"),prop("voltage_index"));
	color: prop(concat("voltage_color_", prop("this_voltage")),"default");
}


/* busbar and bay */
way[power=line][line=busbar]
{
    casing-color:none;
    left-casing-dashes:20,20;
	left-casing-width:2;
    left-casing-color: blue;
    right-casing-dashes:20,20;
	right-casing-width:2;
    right-casing-color:blue;
}

way[power=line][line=bay]
{
    casing-color:none;
    left-casing-dashes:5,10;
	left-casing-width:2;
    left-casing-color: blue;
    right-casing-dashes:5,10;
	right-casing-width:2;
    right-casing-color:blue;
}
/* Non-Power Lines */
/*============================================================================================*/

/* comm lines*/
way[communication=line],
way[telecom=line]
{
	casing-width:2;
    casing-opacity:0.6;
	casing-color:none;
    left-casing-dashes:10,10;
	left-casing-width:2;
	left-casing-offset:1;
    left-casing-color: pink;
    right-casing-dashes:10,10;
	right-casing-dashes-offset:10;
	right-casing-offset:1;
	right-casing-width:2;
    right-casing-color:pink;
}